let activePhoneNumber="+94771889532";const PHONES={DEFAULT:"+94771889532",MV:"+9609718918"};const savedRegion=localStorage.getItem("user_region");let userRegion=savedRegion?JSON.parse(savedRegion):{code:"USD",symbol:"$",country:"US"};const products=[{id:1,name:"Longline Active Top (Top Only)",priceUSD:40,priceLKR:6400,priceMVR:550,sizes:["S","M","L","XL"],colors:[{name:"Black",hex:"#000000",imgMobile:"img/1_mobile.webp",imgDesktop:"img/1_desktop.webp"},{name:"Navy Blue",hex:"#000080",imgMobile:"img/2_mobile.webp",imgDesktop:"img/2_desktop.webp"},{name:"Silver",hex:"#C0C0C0",imgMobile:"img/3_mobile.webp",imgDesktop:"img/3_desktop.webp"},{name:"Maroon",hex:"#800000",imgMobile:"img/4_mobile.webp",imgDesktop:"img/4_desktop.webp"}]},{id:2,name:"Performance Sports Hijab",priceUSD:12,priceLKR:1800,priceMVR:400,sizes:[],colors:[{name:"Black",hex:"#000000",imgMobile:"img/5_mobile.webp",imgDesktop:"img/5_desktop.webp"},{name:"Navy Blue",hex:"#000080",imgMobile:"img/6_mobile.webp",imgDesktop:"img/6_desktop.webp"},{name:"Silver",hex:"#C0C0C0",imgMobile:"img/7_mobile.webp",imgDesktop:"img/7_desktop.webp"},{name:"Maroon",hex:"#800000",imgMobile:"img/8_mobile.webp",imgDesktop:"img/8_desktop.webp"}]},{id:3,name:"Active Top & Hijab Set",priceUSD:47,priceLKR:7600,priceMVR:899,sizes:["S","M","L","XL"],colors:[{name:"Black",hex:"#000000",imgMobile:"img/9_mobile.webp",imgDesktop:"img/9_desktop.webp"},{name:"Navy Blue",hex:"#000080",imgMobile:"img/10_mobile.webp",imgDesktop:"img/10_desktop.webp"},{name:"Silver",hex:"#C0C0C0",imgMobile:"img/11_mobile.webp",imgDesktop:"img/11_desktop.webp"},{name:"Maroon",hex:"#800000",imgMobile:"img/12_mobile.webp",imgDesktop:"img/12_desktop.webp"}]}];async function detectLocation(){const urlParams=new URLSearchParams(window.location.search);const forceLoc=urlParams.get("loc");if(forceLoc){console.log(`üîß Testing Mode: Forcing location to ${forceLoc}`);applyRegionSettings(forceLoc);return}const isLocal=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";const traceUrl=isLocal?"https://www.cloudflare.com/cdn-cgi/trace":"/cdn-cgi/trace";try{const response=await fetch("https://www.cloudflare.com/cdn-cgi/trace");const data=await response.text();const lines=data.split("\n");const locLine=lines.find(line=>line.startsWith("loc="));const countryCode=locLine?locLine.split("=")[1]:"US";if(countryCode!==userRegion.country){console.log("üìç Detected New Location:",countryCode);applyRegionSettings(countryCode)}else{console.log("‚úÖ Location verified (Matches Cache):",countryCode)}}catch(error){console.warn("Location detection failed/blocked. Using default/cached.",error)}}const flagMap={LK:"üá±üá∞",MV:"üá≤üáª",US:"üá∫üá∏",default:"üåç"};function applyRegionSettings(countryCode){if(countryCode==="LK"){userRegion={code:"LKR",symbol:"Rs",country:"LK"};activePhoneNumber=PHONES.DEFAULT}else if(countryCode==="MV"){userRegion={code:"MVR",symbol:"Rf",country:"MV"};activePhoneNumber=PHONES.MV}else{userRegion={code:"USD",symbol:"$",country:"US"};activePhoneNumber=PHONES.DEFAULT}const flagEmoji=flagMap[userRegion.country]||flagMap["default"];const flagEl=document.getElementById("nav-flag");if(flagEl)flagEl.innerText=flagEmoji;const selector=document.getElementById("region-select");if(selector)selector.value=userRegion.country==="LK"||userRegion.country==="MV"?userRegion.country:"US";const phoneLink=document.getElementById("footer-phone");if(phoneLink){const displayNum=userRegion.country==="MV"?"+960 971 8918":"+94 77 188 9532";phoneLink.innerText=displayNum;phoneLink.href=`tel:${activePhoneNumber}`}const promoText=document.getElementById("promo-text");if(promoText){if(userRegion.country==="MV"){promoText.innerHTML=`üéâ <strong>Maldives Launch:</strong> Exclusive Full Sets Available Now!`}else if(userRegion.country==="LK"){promoText.innerHTML=`üöö <strong>Island-wide Delivery:</strong> Get your gear in 2-3 working days.`}else{promoText.innerHTML=`‚úàÔ∏è <strong>International Shipping:</strong> Now shipping globally.`}}if(cart.length>0){refreshCartForNewRegion()}renderProducts();if(cart.length===0)updateCartUI()}function getPrice(product){if(userRegion.code==="LKR")return product.priceLKR;if(userRegion.code==="MVR")return product.priceMVR;return product.priceUSD}let cart=JSON.parse(localStorage.getItem("cart"))||[];let isFirstCartClick=true;document.addEventListener("DOMContentLoaded",()=>{renderProducts();updateCartUI();detectLocation()});function renderProducts(){const list=document.getElementById("product-list");const isMaldives=userRegion.country==="MV";const visibleProducts=isMaldives?products.filter(p=>p.id===3):products;let html=visibleProducts.map(p=>{const defaultColor=p.colors[0];const currentPrice=getPrice(p);const symbol=userRegion.symbol;let sizeSelectorHTML="";if(p.sizes.length>0){sizeSelectorHTML=`\n                <div class="size-row">\n                    <label for="size-${p.id}">Size</label>\n                    <button class="size-btn" onclick="toggleSizeModal(true)">Guide</button>\n                </div>\n                <select id="size-${p.id}">${p.sizes.map(s=>`<option value="${s}">${s}</option>`).join("")}</select>\n            `}else{sizeSelectorHTML=`<input type="hidden" id="size-${p.id}" value="-">`}return`\n        <div class="product-card" id="product-${p.id}" data-selected-color="${defaultColor.name}">\n            <div class="card-img-container">\n                <picture>\n                    <source srcset="${defaultColor.imgDesktop}" media="(min-width: 768px)" class="source-${p.id} ">\n                    <img src="${defaultColor.imgMobile}" class="card-img main-img-${p.id}" alt="${p.name}">\n                </picture>\n            </div>\n            \n            <div class="card-body">\n                <div class="card-header">\n                    <h3>${p.name}</h3>\n                    <span class="price">${symbol} ${currentPrice.toFixed(2)}</span>\n                </div>\n\n                <div class="options-area">\n                    ${sizeSelectorHTML}\n                    <label style="display:block; margin-bottom:8px">Color</label>\n                    <div class="color-options">\n                        ${p.colors.map((c,index)=>`\n                            <div class="color-circle ${index===0?"active":""}" \n                                 style="background-color: ${c.hex};" \n                                 onclick="selectColor(${p.id}, '${c.name}', '${c.imgMobile}', '${c.imgDesktop}', this)">\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n\n                <button class="btn-add" onclick="addToCart(${p.id})">\n                    Add to Cart <i class="fa-solid fa-plus"></i>\n                </button>\n            </div>\n        </div>\n        `}).join("");if(isMaldives){html+=`\n        <div class="product-card coming-soon-card">\n            <div class="card-img-container">\n                 <div class="cs-overlay">\n                    <h3>COMING SOON</h3>\n                    <p>Individual Pieces</p>\n                 </div>\n                 <img src="img/1_mobile.webp" class="card-img"> \n            </div>\n            <div class="card-body">\n                <div class="card-header">\n                     <h3 style="color:#999;">Top & Hijab Separates</h3>\n                     <span class="price" style="color:#aaa;">Dropping Later</span>\n                </div>\n                <div style="flex-grow:1; display:flex; align-items:center; justify-content:center; text-align:center; color:#777; font-size:0.9rem;">\n                    <p>Currently available exclusively as a full set for our Maldives launch.</p>\n                </div>\n                <button class="btn-add" style="background:#ccc; cursor:not-allowed;">\n                    Locked\n                </button>\n            </div>\n        </div>\n        `}list.innerHTML=html}function selectColor(productId,colorName,mobilePath,desktopPath,element){const card=document.getElementById(`product-${productId}`);card.setAttribute("data-selected-color",colorName);const circles=card.querySelectorAll(".color-circle");circles.forEach(c=>c.classList.remove("active"));element.classList.add("active");const mobileImg=card.querySelector(`.main-img-${productId}`);const desktopSource=card.querySelector(`.source-${productId}`);mobileImg.style.opacity="0.5";const loader=new Image;loader.src=mobilePath;loader.onload=()=>{desktopSource.srcset=desktopPath;mobileImg.src=mobilePath;mobileImg.style.opacity="1"}}function addToCart(productId){const product=products.find(p=>p.id===productId);const card=document.getElementById(`product-${productId}`);const clickedBtn=card.querySelector(".btn-add");const sizeInput=document.getElementById(`size-${productId}`);const size=sizeInput?sizeInput.value:"-";const color=card.getAttribute("data-selected-color");const finalPrice=getPrice(product);const variantId=`${product.id}-${size}-${color}-${userRegion.code}`;const existing=cart.find(item=>item.variantId===variantId);let newQty=1;if(existing){existing.qty++;newQty=existing.qty}else{cart.push({variantId:variantId,id:product.id,name:product.name,price:finalPrice,currency:userRegion.code,symbol:userRegion.symbol,size:size,color:color,qty:1})}saveCart();if(isFirstCartClick){runFlyingAnimation(clickedBtn);isFirstCartClick=false}else{triggerBounceAnimation()}const originalText=`Add to Cart <i class="fa-solid fa-plus"></i>`;clickedBtn.innerHTML=`Added! ( ${newQty} ) <i class="fa-solid fa-check"></i>`;clickedBtn.style.background="#333";clickedBtn.style.color="#fff";if(clickedBtn.feedbackTimeout)clearTimeout(clickedBtn.feedbackTimeout);clickedBtn.feedbackTimeout=setTimeout(()=>{clickedBtn.innerHTML=originalText;clickedBtn.style.background="";clickedBtn.style.color=""},1500)}function runFlyingAnimation(startBtn){const startRect=startBtn.getBoundingClientRect();const startX=startRect.left+startRect.width/2;const startY=startRect.top+startRect.height/2;const cartIcon=document.querySelector(".cart-icon i");const endRect=cartIcon.getBoundingClientRect();const endX=endRect.left+endRect.width/2;const endY=endRect.top+endRect.height/2;const particle=document.createElement("div");particle.classList.add("flying-particle");document.body.appendChild(particle);particle.style.left=`${startX-12}px`;particle.style.top=`${startY-12}px`;const deltaX=endX-startX;const deltaY=endY-startY;particle.style.setProperty("--end-x",`${deltaX}px`);particle.style.setProperty("--end-y",`${deltaY}px`);particle.addEventListener("animationend",()=>{particle.remove();triggerBounceAnimation()})}function triggerBounceAnimation(){const cartIconBigger=document.querySelector(".cart-icon i");cartIconBigger.style.animation="none";cartIconBigger.offsetHeight;cartIconBigger.style.animation=null;cartIconBigger.style.animation="bounce-add 0.8s ease"}function removeFromCart(variantId){cart=cart.filter(item=>item.variantId!==variantId);saveCart()}function saveCart(){localStorage.setItem("cart",JSON.stringify(cart));updateCartUI()}function increaseQty(variantId){const item=cart.find(i=>i.variantId===variantId);if(item){item.qty++;saveCart()}}function decreaseQty(variantId){const item=cart.find(i=>i.variantId===variantId);if(item){item.qty--;if(item.qty<=0){removeFromCart(variantId)}else{saveCart()}}}function updateCartUI(){const badge=document.getElementById("cart-badge");const itemsList=document.getElementById("cart-items");const totalEl=document.getElementById("total-price");const count=cart.reduce((acc,item)=>acc+item.qty,0);badge.innerText=count;badge.classList.toggle("hidden",count===0);if(cart.length===0){itemsList.innerHTML=`\n            <li style="list-style:none; text-align:center; padding:20px; color:#999;">\n                <div style="display:flex; flex-direction:column; align-items:center; gap:10px;">\n                    <i class="fa-solid fa-basket-shopping" style="font-size:2rem;"></i>\n                    <p style="margin:0;">Your bag is empty</p>\n                </div>\n            </li>`;totalEl.innerText=`${userRegion.symbol} 0.00`;return}let total=0;itemsList.innerHTML=cart.map(item=>{total+=item.price*item.qty;return`\n            <li class="cart-item">\n                <div class="item-info">\n                    <h4>${item.name}</h4>\n                    <div class="item-meta">\n                        ${item.size!=="One Size"?`Size: <b>${item.size}</b> | `:""} \n                        Color: <b>${item.color}</b><br>\n                        \n                    </div>\n                    <div style="display:flex; align-items:center; gap:10px; margin-top:8px;">\n                        <button onclick="decreaseQty('${item.variantId}')" style="padding:2px 8px; cursor: pointer; font-size: 1rem; border:1px solid #ddd; background:#fff; border-radius:4px;">-</button>\n                        <span>${item.qty}</span>\n                        <button onclick="increaseQty('${item.variantId}')" style="padding:2px 8px; cursor: pointer; font-size: 1rem; border:1px solid #ddd; background:#fff; border-radius:4px;">+</button>\n                    </div>\n                </div>\n                <div class="item-right">\n                <div style="font-weight:bold;">${item.symbol} ${(item.price*item.qty).toFixed(2)}</div>\n                <button class="remove-btn" onclick="removeFromCart('${item.variantId}')">Remove</button>\n            </div>\n            </li>\n        `}).join("");totalEl.innerText=`${userRegion.symbol} ${total.toFixed(2)}`}function toggleCart(show){const sidebar=document.getElementById("cart-sidebar");const overlay=document.getElementById("cart-overlay");if(show){sidebar.classList.add("open");overlay.style.display="block"}else{sidebar.classList.remove("open");overlay.style.display="none"}}function toggleSizeModal(show){const modal=document.getElementById("size-modal");modal.style.display=show?"flex":"none"}window.onclick=function(event){const modal=document.getElementById("size-modal");if(event.target===modal){toggleSizeModal(false)}};document.getElementById("checkout-btn").addEventListener("click",()=>{if(cart.length===0)return alert("Add items first!");let msg=`Hello! I'd like to place an order via InnerAthlete (${userRegion.code}):\n\n`;let total=0;cart.forEach(item=>{const sub=item.price*item.qty;total+=sub;msg+=`‚ñ™ ${item.name} (${item.size}/${item.color})\n   ${item.symbol}${item.price} x ${item.qty} = ${item.symbol}${sub.toFixed(2)}\n`});msg+=`\nTotal: ${userRegion.symbol} ${total.toFixed(2)}`;window.open(`https://api.whatsapp.com/send?phone=${activePhoneNumber}&text=${encodeURIComponent(msg)}`,"_blank")});document.addEventListener("DOMContentLoaded",()=>{renderProducts();updateCartUI();const observerOptions={threshold:.15,rootMargin:"0px 0px -50px 0px"};const observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){entry.target.classList.add("active")}else{if(entry.boundingClientRect.top>0){entry.target.classList.remove("active")}}})},observerOptions);const elementsToAnimate=document.querySelectorAll(".scroll-reveal, .fade-in-up, .fade-in-left");elementsToAnimate.forEach(el=>observer.observe(el))});function manualChangeRegion(selectedCountry){console.log("Manual override to:",selectedCountry);applyRegionSettings(selectedCountry);window.scrollTo({top:0,behavior:"smooth"})}function refreshCartForNewRegion(){let itemsRemoved=false;cart=cart.map(item=>{const product=products.find(p=>p.id===item.id);if(userRegion.country==="MV"&&(item.id===1||item.id===2)){itemsRemoved=true;return null}const newPrice=getPrice(product);const newVariantId=`${item.id}-${item.size}-${item.color}-${userRegion.code}`;return{...item,price:newPrice,symbol:userRegion.symbol,currency:userRegion.code,variantId:newVariantId}}).filter(item=>item!==null);if(itemsRemoved){alert("Note: Some items in your cart are not available in the Maldives region and have been removed.")}saveCart();updateCartUI()}document.addEventListener("DOMContentLoaded",()=>{const textElement=document.getElementById("typewriter-text");const phrases=["Premium Modest Activewear","Engineered for Motion","Designed for Confidence","Uncompromising Quality"];let phraseIndex=0;let charIndex=0;let isDeleting=false;function typeEffect(){const currentPhrase=phrases[phraseIndex];if(isDeleting){textElement.textContent=currentPhrase.substring(0,charIndex-1);charIndex--}else{textElement.textContent=currentPhrase.substring(0,charIndex+1);charIndex++}let typeSpeed=isDeleting?40:90;if(!isDeleting&&charIndex===currentPhrase.length){typeSpeed=2e3;isDeleting=true}else if(isDeleting&&charIndex===0){isDeleting=false;phraseIndex=(phraseIndex+1)%phrases.length;typeSpeed=500}setTimeout(typeEffect,typeSpeed)}typeEffect()});function createSnowflake(){const snowflake=document.createElement("div");snowflake.classList.add("snowflake");const size=Math.random()*3+2;snowflake.style.width=`${size}px`;snowflake.style.height=`${size}px`;snowflake.style.left=Math.random()*100+"vw";snowflake.style.opacity=Math.random()*.4+.1;const duration=Math.random()*10+10;snowflake.animate([{transform:"translateY(0px)"},{transform:`translateY(100vh)`}],{duration:duration*1e3,easing:"linear",fill:"forwards"});document.body.appendChild(snowflake);setTimeout(()=>{snowflake.remove()},duration*1e3)}setInterval(createSnowflake,200);